## Витрины CDM
### dm_settlement_report
Состав витрины:
* id — идентификатор записи;
* restaurant_id — идентификатор ресторана (строковый, из системы-источника);
* restaurant_name — название ресторана;
* settlement_date — дата отчёта;
* orders_count — количество заказов;
* orders_total_sum — общая сумма заказов клиентов;
* orders_bonus_payment_sum — сумма оплат бонусами;
* orders_bonus_granted_sum — сумма накопленных бонусов;
* order_processing_fee — сумма, удержанная компанией за обработку заказов;
* restaurant_reward_sum — сумма, которую необходимо перечислить ресторану.
### dm_courier_ledger
Состав витрины:
* id — идентификатор записи.
* courier_id — ID курьера, которому перечисляем.
* courier_name — Ф. И. О. курьера.
* settlement_year — год отчёта.
* settlement_month — месяц отчёта, где 1 — январь и 12 — декабрь.
* orders_count — количество заказов за период (месяц).
* orders_total_sum — общая стоимость заказов.
* rate_avg — средний рейтинг курьера по оценкам пользователей.
* order_processing_fee — сумма, удержанная компанией за обработку заказов, которая высчитывается как orders_total_sum * 0.25.
* courier_order_sum — сумма, которую необходимо перечислить курьеру за доставленные им/ей заказы. За каждый доставленный заказ курьер должен получить некоторую сумму в зависимости от рейтинга (см. ниже).
* courier_tips_sum — сумма, которую пользователи оставили курьеру в качестве чаевых.
* courier_reward_sum — сумма, которую необходимо перечислить курьеру. Вычисляется как courier_order_sum + courier_tips_sum * 0.95 (5% — комиссия за обработку платежа).
Правила расчёта процента выплаты курьеру в зависимости от рейтинга, где r — это средний рейтинг курьера в текущем месяце:
- r < 4 — 5% от заказа, но не менее 100 руб.;
- 4 <= r < 4.5 — 7% от заказа, но не менее 150 руб.;
- 4.5 <= r < 4.9 — 8% от заказа, но не менее 175 руб.;
- 4.9 <= r — 10% от заказа, но не менее 200 руб.
