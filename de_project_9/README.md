## Проект 9-го спринта

### Задание

Спроектировать хранилище данных для сервиса доставки из ресторанов, предполагается, что в будущем оно 
будет активно расширяться и развиваться. 

Исходные данные: 
- Входящий поток с заказами в Kafka в формате JSON.
- База Redis со словарными данными (блюда, рестораны, пользователи). 

С функциональной точки зрения структура хранилища стандартная: слои STG, DDS, CDM. 

Особенности слоёв: 

    В STG — исходные данные as is.
    В DDS — модель данных Data Vault.
	В CDM — две витрины. Первая витрина — счётчик заказов по блюдам; вторая — счётчик заказов по категориям товаров.


В качестве БД используется PostgreSQL. Логику обработки данных нужно написать на Python, она будет разворачиваться в Kubernetes. Брокер сообщений как на вход, так и для обмена данными между сервисами — Kafka.
Нужно построить дашборды на основе данных в DWH.

### Решение

Были разработаны облачные сервисы для загрузки и обработки данных из системы заказов. 

Описание сервисов: 
- stg-service - DWH слой STG
	- получает сырые данные из источника (топик Kafka order-service_orders)
	- обогащает их данными из key-value хранилища в Redis
	- загружает as is в STG слой хранилища в Postrge SQL
	- отправляет обогащенные данные в топик Kafka stg-service_orders
- dds-service - DWH слой DDS
	- читает данные из топика Kafka stg-service_orders
	- заполняет таблицы в DDS слое хранилища, в соответствии с моделью Data Vault. Подробная схема в приложенной ERD-диаграмме. 
	- формирует и пересылает данные, необходимые для построения витрин в топик Kafka dds-service_orders
- cdm-service - DWH слой CDM
	- читает данные из топика Kafka dds-service_orders
	- агрегирует данные в соответствии с требованиями к витринам: количество заказов на пользователя в разрезе продуктов и в разрезе категорий продуктов, учитываются только уникальные заказы. 
	- загружает агрегированные данные в CDM-слой хранилища, таблицы cdm.

Сервисы разворачивались при помощи менеджера пакетов HELM.


[Функциональная схема работы](Schema.png). 

[ERD схема DDS слоя](DDS-ERD.png)

[Дэшборд DataLens](https://datalens.yandex/tvkkdnieb556j)

Дэшборд состоит из 4 диаграмм: 
- круговая диаграмма: популярность категорий блюд на основе доли пользователей, которые заказывали блюда этой категории;
- круговая диаграмма: популярность категорий блюд на основе доли заказов, в которых были блюда этой категории;
- столбчатая диаграмма: популярность блюд по количеству уникальных пользователей, заказавших блюдо, сортировка по убыванию количества уникальных пользователей, столбцы раскрашены в зависимости от ресторана, в котором подается блюдо;
- столбчатая диаграмма, показывающая популярность блюд по количеству заказов, в которых было блюдо, сортировка по убыванию количества заказов, столбцы раскрашены в зависимости от ресторана, в котором подается блюдо.
